/*! Single page application framework - v0.3.0 - 2016-11-04
* https://github.com/dzhdmitry/spa
* Copyright (c) 2016 Dmitry Dzhuleba;
* Licensed MIT
*/
!function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone"],b):a.SPA=b(a._,a.Backbone)}(this,function(a,b){var c={};return a?b?(c.View=b.View.extend({tagName:"div",initialize:function(){this.listenTo(this.model,"render",this.render),this.listenTo(this.model,"change:active",this.toggleActive)},template:function(a){return""},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},toggle:function(a){var b=a?"block":"none";this.$el.css("display",b)},toggleActive:function(){this.toggle(this.model.get("active"))}}),c.Model=b.Model.extend({idAttribute:"uri",defaults:{active:!1,title:""},getFetchOptions:function(){return{}},url:function(){return"/"+this.get("uri")},show:function(){this.set("active",!0),b.$("title").html(this.get("title")),this.hasChanged("active")&&this.trigger("shown")},hide:function(){this.set("active",!1),this.hasChanged("active")&&this.trigger("hidden")}}),c.Collection=b.Collection.extend({model:c.Model,view:c.View,createView:function(b){function c(a){var b=new d.view({model:a});d.el.append(b.render().el),b.toggleActive()}var d=this;a.isArray(b)?a.each(b,c):c(b)},addPage:function(a,b){var c=this.add(a);return b&&this.createView(c),c},mergePage:function(a,b){var c=this.add(a,{merge:!0});return b?this.createView(c):c.trigger("render"),c},open:function(a){this.each(function(b){b.get("uri")==a?b.show():b.hide()})}}),c.Router=b.Router.extend({collection:c.Collection,initialize:function(d){var e={el:b.$("body"),start:!0,pushState:!1,root:"/",pages:[]},f=a.extend({},e,d);this.pushState=f.pushState,this.root=f.root,this.pages=new this.collection,this.pages.el=f.el,this.listenTo(this.pages,"reset",function(a){a.each(function(b){a.createView(b)})}),this.pages.reset(f.pages),f.start&&b.history.start({pushState:f.pushState,root:f.root}),c.Router.__super__.initialize.call(this,d)},start:function(){b.history.start({pushState:this.pushState,root:this.root})},stop:function(){b.history.stop()},go:function(c,d){function e(){i.open(h.uri)}function f(b,c){var d={success:function(a){i.mergePage(a,c),e()}};b.fetch(a.extend(d,b.getFetchOptions()))}var g=this.pushState?b.history.getPath():b.history.getHash(),h=a.extend({uri:g},c),i=this.pages,j=a.extend({},{force:!1,load:!1},d);if(this.pages.has(h.uri))if(j.force)if(j.load){var k=this.pages.get(h.uri);f(k,!1)}else this.pages.mergePage(h,!1),e();else e();else if(j.load){var l=this.pages.addPage(h,!1);f(l,!0)}else this.pages.addPage(h,!0),e()}}),c):void console.error("Backbone is required by SPA"):void console.error("Underscore is required by SPA")});